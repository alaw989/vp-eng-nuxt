---
phase: 05-qa-&-pwa-foundation
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified: [nuxt.config.ts, components/PwaInstallPrompt.vue, layouts/default.vue]
autonomous: true

must_haves:
  truths:
    - "Browser native install prompt appears when PWA installation criteria are met"
    - "No custom install button in navigation (browser native only per context decision)"
    - "App icon is site logo/icon.svg (not generic PWA icon)"
    - "App launches in standalone mode when installed"
  artifacts:
    - path: "nuxt.config.ts"
      provides: "PWA manifest with app icons"
      contains: "pwa.manifest.icons"
    - path: "public/images/icon.svg"
      provides: "Site logo for PWA icon"
      min_lines: 5
    - path: "public/images/icon-192x192.png"
      provides: "192x192 PNG icon fallback"
    - path: "public/images/og-default.jpg"
      provides: "512x512 fallback icon"
  key_links:
    - from: "nuxt.config.ts"
      to: "public/images/icon.svg"
      via: "manifest.icons src"
      pattern: "src.*icon.svg"
    - from: "layouts/default.vue"
      to: "components/PwaInstallPrompt.vue"
      via: "component registration"
      pattern: "PwaInstallPrompt"
---

<objective>
Configure PWA install prompt to use browser native prompt only (no custom button per Phase 5 Context decision). Verify app icons are properly configured.

Purpose: Per Phase 5 Context decision, install prompt should be browser native only with timing after 30-60 seconds on site. Custom install buttons can be intrusive. Existing PwaInstallPrompt component should be removed or modified to use browser native behavior.

Output: Clean install prompt configuration using browser native prompt, verified app icons, updated layouts and components.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-qa-&-pwa-foundation**---build-testing-infrastructure-and-pwa-features/05-CONTEXT.md
@.planning/phases/05-qa-&-pwa-foundation**---build-testing-infrastructure-and-pwa-features/05-RESEARCH.md
@.planning/phases/05-qa-&-pwa-foundation**---build-testing-infrastructure-and-pwa-features/05-01-SUMMARY.md
@nuxt.config.ts
@layouts/default.vue
@components/PwaInstallPrompt.vue
</context>

<tasks>

<task type="auto">
  <name>Review PWA install context decision and existing implementation</name>
  <files>components/PwaInstallPrompt.vue, layouts/default.vue, .planning/phases/05-qa-&-pwa-foundation**---build-testing-infrastructure-and-pwa-features/05-CONTEXT.md</files>
  <action>
    Read the Phase 5 Context decisions for install prompt:

    From 05-CONTEXT.md:
    - Discovery method: Browser native prompt only (no custom button)
    - Timing: After 30-60 seconds on site
    - Dismiss behavior: Never ask again (respect user choice)
    - App icon: Site logo/favicon (not generic PWA icon)

    Current implementation:
    - layouts/default.vue includes <LazyPwaInstallPrompt /> (line 25)
    - components/PwaInstallPrompt.vue is a custom component with styled modal
    - This contradicts the "browser native only" decision

    Decision options:
    1. Remove PwaInstallPrompt entirely and rely on browser native prompt
    2. Keep PwaInstallPrompt but modify it to only trigger browser native prompt (no custom UI)

    Given @vite-pwa/nuxt with client.installPrompt: true already enables browser native prompt, the custom component is redundant. However, some users prefer having a custom UI as an alternative to the browser prompt which can be subtle.

    Approach: Modify PwaInstallPrompt to be a simple trigger for browser native prompt only. Remove the custom modal UI and replace with a subtle "Install App" link in navigation that triggers browser native install prompt.
  </action>
  <verify>
    - Phase 5 Context decisions are understood
    - Current implementation uses custom modal
    - Decision is to simplify to browser native trigger only
  </verify>
  <done>
    Context decision reviewed: install prompt should be browser native only. Current custom modal will be simplified.
  </done>
</task>

<task type="auto">
  <name>Simplify PwaInstallPrompt to browser native trigger only</name>
  <files>components/PwaInstallPrompt.vue</files>
  <action>
    Replace components/PwaInstallPrompt.vue with a simplified version that:
    1. Does NOT show a custom modal (remove the Transition div with custom UI)
    2. DOES provide a small, subtle install option in navigation
    3. Calls $pwa.install() which triggers the browser native install prompt

    New simplified component:
    - Small "Install App" button/link that appears when $pwa.showInstallPrompt is true
    - Uses ClientOnly to prevent hydration issues
    - Calls $pwa.install() directly (triggers browser native prompt)
    - Has no custom modal or persistent UI

    Replace entire file content with:

    ```vue
    <script setup lang="ts">
    const { $pwa } = useNuxtApp()

    // Show install prompt when PWA can be installed
    const canInstall = computed(() => {
      const showPrompt = $pwa?.showInstallPrompt
      const isInstalled = $pwa?.isPWAInstalled
      return showPrompt === true && (isInstalled === false || isInstalled === undefined)
    })

    // Install the PWA (triggers browser native prompt)
    async function installApp() {
      await $pwa?.install()
    }
    </script>

    <template>
      <ClientOnly>
        <button
          v-if="canInstall"
          type="button"
          class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors"
          @click="installApp"
          title="Install app on your device"
        >
          <Icon name="mdi:download" class="inline mr-1" />
          Install App
        </button>
      </ClientOnly>
    </template>
    ```

    This creates a simple link that triggers the browser's native install prompt, not a custom modal.
  </action>
  <verify>
    - components/PwaInstallPrompt.vue is simplified to ~30 lines
    - No custom modal UI (Transition, custom dialog removed)
    - Uses ClientOnly wrapper to prevent hydration issues
    - Calls $pwa.install() which triggers browser native prompt
  </verify>
  <done>
    PwaInstallPrompt is now a simple link that triggers browser native install prompt. No custom modal.
  </done>
</task>

<task type="auto">
  <name>Verify app icon configuration in manifest</name>
  <files>nuxt.config.ts, public/images/icon.svg</files>
  <action>
    Verify the PWA manifest icons are correctly configured in nuxt.config.ts.

    Current manifest configuration (lines 195-224):
    - name: 'VP Associates - Structural Engineering Services'
    - short_name: 'VP Associates'
    - icons array with:
      - /images/icon.svg (192x192 512x512, image/svg+xml)
      - /images/og-default.jpg (192x192, image/jpeg)
      - /images/og-default.jpg (512x512, image/jpeg)

    Verify files exist:
    - public/images/icon.svg ✓ (exists, verified earlier)
    - public/images/icon-192x192.png ✓ (exists, verified earlier)
    - public/images/og-default.jpg ✓ (exists, verified earlier)

    Per Phase 5 Context: "App icon: Site logo/favicon (not generic PWA icon)"
    - icon.svg is the site logo (blue VP ENG text)
    - This is correct, no changes needed

    Optional improvement: Generate proper PNG icons at all required sizes (72, 96, 128, 144, 152, 192, 384, 512) using a tool like pwa-asset-generator. For now, the existing icon-192x192.png and og-default.jpg are sufficient placeholders.

    No changes needed to nuxt.config.ts - icons are correctly configured.
  </action>
  <verify>
    - nuxt.config.ts pwa.manifest.icons references /images/icon.svg and /images/og-default.jpg
    - public/images/icon.svg exists
    - public/images/icon-192x192.png exists
    - public/images/og-default.jpg exists
  </verify>
  <done>
    App icons are configured using site logo (icon.svg) and fallback images. No generic PWA icons.
  </done>
</task>

<task type="auto">
  <name>Test install prompt functionality</name>
  <files>.output/public/manifest.webmanifest</files>
  <action>
    Build and test the install prompt functionality:

    1. Build: npm run build
    2. Start preview: npm run preview
    3. Open http://localhost:3000 in Chrome

    Check PWA criteria in Chrome DevTools:
    1. Open DevTools > Application > Manifest
    2. Verify manifest loads correctly with name, icons, theme_color
    3. Check "Install" criteria - all should be checked

    Install prompt testing:
    1. In Chrome, the browser will show install prompt automatically after ~30-60 seconds on site
    2. The simplified PwaInstallPrompt button should appear in navigation when criteria met
    3. Clicking the button should trigger browser native install dialog

    To force test install criteria:
    - Use Chrome DevTools > Application > Installability
    - Check that no issues are reported

    Note: Install prompts only appear on HTTPS (or localhost). The preview server on localhost:3000 qualifies.

    Kill preview server after testing: Ctrl+C
  </action>
  <verify>
    - .output/public/manifest.webmanifest exists and is valid JSON
    - Chrome DevTools Application > Manifest shows correct icons, name, theme_color
    - Installability section shows no issues
    - PwaInstallPrompt button appears when criteria met
  </verify>
  <done>
    Install prompt uses browser native dialog, triggered automatically or via simplified navigation button. Icons are site logo.
  </done>
</task>

</tasks>

<verification>
Overall verification of install prompt configuration:

1. PwaInstallPrompt component is simplified (no custom modal, ~30 lines)
2. Browser native install prompt appears after 30-60 seconds on site
3. Manifest includes site logo as app icon (not generic PWA icon)
4. Chrome DevTools shows no installability issues
5. Clicking "Install App" button triggers browser native install dialog

Run: npm run build && npm run preview
Then check Chrome DevTools > Application > Manifest and Installability.
</verification>

<success_criteria>
1. Install prompt is browser native only (no custom modal)
2. App icon uses site logo (icon.svg)
3. Simplified PwaInstallPrompt component triggers browser native prompt
4. App launches in standalone mode when installed (verified via manifest display: standalone)
5. Build completes without errors and manifest is valid
</success_criteria>

<output>
After completion, create `.planning/phases/05-qa-&-pwa-foundation**---build-testing-infrastructure-and-pwa-features/05-02-SUMMARY.md` with:
- PwaInstallPrompt component changes made
- Icon configuration summary
- Install prompt testing results
- Screenshot or description of install behavior
</output>
