---
phase: 01-audit-baseline-capture
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - .planning/audit/baselines/metadata.json
  - .planning/audit/README.md
autonomous: true

must_haves:
  truths:
    - "Audit metadata file documents all captured baselines with timestamps"
    - "README explains audit directory structure and how to use baseline images"
    - "Page inventory is complete and discoverable"
    - "Baseline files are organized for easy comparison in future phases"
  artifacts:
    - path: ".planning/audit/baselines/metadata.json"
      provides: "Structured metadata about baseline capture session"
      contains: "\"captureDate\":"
    - path: ".planning/audit/README.md"
      provides: "Documentation for audit directory and baseline usage"
      min_lines: 50
  key_links:
    - from: ".planning/audit/baselines/metadata.json"
      to: ".planning/audit/pages.json"
      via: "Referencing page inventory"
      pattern: "\"pagesFile\":.*pages\\.json"
    - from: ".planning/audit/README.md"
      to: ".planning/audit/baselines/"
      via: "Directory documentation"
      pattern: "baselines/"
---

<objective>
Create metadata documentation and README for the audit directory to establish a complete, discoverable baseline record that enables future comparison work.

Purpose: REQ-AUD-001 and REQ-AUD-002 require organized audit results. Phase 2 (Comparison Infrastructure) will depend on well-documented baselines to build diff tools. This plan finalizes the audit phase with proper documentation.

Output: metadata.json documenting capture session, and README.md explaining directory structure and usage.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-audit-baseline-capture/01-RESEARCH.md
@.planning/phases/01-audit-baseline-capture/01-01-PLAN.md
@.planning/phases/01-audit-baseline-capture/01-02-PLAN.md

# Prerequisites from 01-01 and 01-02:
- .planning/audit/pages.json exists with complete page inventory
- .planning/audit/baselines/ directory contains screenshots for all pages
- Each page has 3 screenshots: mobile.png, tablet.png, desktop.png

# Key implementation details from research:
- Metadata should include: captureDate, source, viewports, pages list
- README should explain structure and how baselines are used for comparison
- Phase 2 will build comparison tools using this baseline organization
</context>

<tasks>

<task type="auto">
  <name>Generate baseline metadata file</name>
  <files>.planning/audit/baselines/metadata.json</files>
  <action>
    Create `.planning/audit/baselines/metadata.json` with the following structure:

    1. Read `.planning/audit/pages.json` to get page list
    2. Get current ISO timestamp: `new Date().toISOString()`
    3. Scan `.planning/audit/baselines/` directory to find all screenshot files
    4. Build metadata object:
       ```json
       {
         "captureDate": "ISO-8601 timestamp of when baselines were captured",
         "captureTool": "playwright@{version from package.json}",
         "source": "https://www.vp-associates.com",
         "viewports": {
           "mobile": { "width": 375, "height": 812, "description": "iPhone X" },
           "tablet": { "width": 768, "height": 1024, "description": "iPad" },
           "desktop": { "width": 1920, "height": 1080, "description": "Full HD" }
         },
         "pagesFile": ".planning/audit/pages.json",
         "pages": [
           {
             "slug": "home",
             "url": "https://www.vp-associates.com/",
             "type": "page",
             "screenshots": {
               "mobile": "baselines/home/mobile.png",
               "tablet": "baselines/home/tablet.png",
               "desktop": "baselines/home/desktop.png"
             },
             "capturedAt": "ISO-8601 timestamp",
             "fileSizes": {
               "mobile": "size in bytes",
               "tablet": "size in bytes",
               "desktop": "size in bytes"
             }
           }
           // ... repeat for each page in pages.json
         ],
         "summary": {
           "totalPages": "number of pages",
           "totalScreenshots": "number of screenshots (pages × 3)",
           "totalSize": "total bytes of all screenshots",
           "missingScreenshots": ["list of any missing viewport screenshots"]
         }
       }
       ```

    5. For each page in pages.json:
       - Check if mobile.png, tablet.png, desktop.png exist
       - Get file size using `fs/promises stat`
       - Add to pages array with all metadata

    6. Calculate summary statistics
    7. Write to `.planning/audit/baselines/metadata.json` with JSON.stringify(data, null, 2)

    DO NOT modify pages.json or any screenshot files - only read them.
    DO NOT include absolute paths - use paths relative to .planning/audit/
  </action>
  <verify>
    1. `cat .planning/audit/baselines/metadata.json | jq '.captureDate'` returns valid ISO timestamp
    2. `cat .planning/audit/baselines/metadata.json | jq '.pages | length'` matches page count in pages.json
    3. `cat .planning/audit/baselines/metadata.json | jq '.summary.totalScreenshots'` equals pages × 3
    4. All pages entries have screenshots object with mobile, tablet, desktop keys
  </verify>
  <done>
    metadata.json exists with complete documentation of baseline capture session, including all pages, screenshot paths, file sizes, and summary statistics
  </done>
</task>

<task type="auto">
  <name>Create audit directory README documentation</name>
  <files>.planning/audit/README.md</files>
  <action>
    Create `.planning/audit/README.md` with the following sections:

    1. **Header**: "# Audit & Baseline Directory"

    2. **Overview**: Explain this directory contains the baseline capture of vp-associates.com before any modernization work. Established during Phase 1 of the roadmap.

    3. **Directory Structure**:
       ```
       .planning/audit/
       ├── pages.json              # Complete page inventory with URLs and metadata
       ├── baselines/              # Visual screenshots of all pages
       │   ├── metadata.json       # Capture session metadata
       │   ├── home/
       │   │   ├── mobile.png      # 375x812 viewport
       │   │   ├── tablet.png      # 768x1024 viewport
       │   │   └── desktop.png     # 1920x1080 viewport
       │   ├── about/
       │   └── ...
       └── README.md               # This file
       ```

    4. **Files**:
       - **pages.json**: Generated by 01-01-PLAN, contains all pages discovered from sitemap.xml
       - **baselines/**: Screenshots captured by 01-02-PLAN using Playwright
       - **metadata.json**: Generated by 01-03-PLAN, documents capture session details

    5. **Viewing Baselines**:
       - Open any PNG file directly in an image viewer
       - Use metadata.json for programmatic access to all screenshots
       - Each page has 3 viewport variants for responsive comparison

    6. **Usage in Comparison Phase**:
       - Phase 2 will build comparison tools using these baselines
       - Pixel diff tools will compare new screenshots against these originals
       - Baselines are immutable - new comparisons always reference these files

    7. **Regenerating Baselines** (if needed):
       - Run `npx tsx .planning/scripts/enumerate-pages.ts` to refresh pages.json
       - Run `npx tsx .planning/scripts/capture-baselines.ts` to recapture all screenshots
       - Only regenerate if source site structure changes significantly

    8. **Page Inventory Summary**:
       - List page count by type (from pages.json)
       - Note any special cases or anomalies discovered during enumeration

    9. **Related Documentation**:
       - Phase 1 Research: `.planning/phases/01-audit-baseline-capture/01-RESEARCH.md`
       - Requirements: `.planning/REQUIREMENTS.md` (REQ-AUD-001, REQ-AUD-002)
       - Roadmap: `.planning/ROADMAP.md` (Phase 1 entry)

    DO NOT include implementation code samples - this is documentation, not a tutorial.
    DO NOT reference absolute paths that may vary across systems.
  </action>
  <verify>
    1. `head -20 .planning/audit/README.md` shows title and overview sections
    2. `grep -c "##" .planning/audit/README.md` returns at least 6 (6+ sections with ## headers)
    3. `grep "pages.json\|baselines/\|metadata.json" .planning/audit/README.md` confirms file references
    4. File is at least 50 lines (use `wc -l`)
  </verify>
  <done>
    README.md exists with complete documentation of audit directory structure, file purposes, and usage instructions for downstream phases
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:
1. `cat .planning/audit/baselines/metadata.json | jq '.'` returns valid JSON with all required fields
2. `test -f .planning/audit/README.md && echo "exists"` confirms README exists
3. `grep -E "pages.json|baselines|metadata.json|Phase 1|comparison" .planning/audit/README.md` returns relevant context matches
4. All files in .planning/audit/ are documented in README
</verification>

<success_criteria>
1. metadata.json contains complete inventory of all baseline screenshots with paths and sizes
2. README.md explains directory structure to anyone unfamiliar with the project
3. Summary section in metadata.json provides quick stats (total pages, total screenshots, total size)
4. Documentation references related planning docs (RESEARCH, REQUIREMENTS, ROADMAP)
5. Phase 1 is complete and ready for Phase 2 (Comparison Infrastructure) to begin
</success_criteria>

<output>
After completion, create `.planning/phases/01-audit-baseline-capture/01-03-SUMMARY.md` with:
- Confirmation that Phase 1 audit is complete
- Summary statistics from metadata.json
- Confirmation that all success criteria for Phase 1 are met
- Note that Phase 2 (Comparison Infrastructure) can now begin
</output>
