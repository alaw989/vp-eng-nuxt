---
phase: 20-advanced-micro-interactions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - composables/useScrollReveal.ts
  - components/AppSection.vue
  - assets/css/main.css
autonomous: true

must_haves:
  truths:
    - "Elements animate smoothly when scrolling into viewport"
    - "Scroll animations respect prefers-reduced-motion setting"
    - "Scroll animations trigger once and stop observing (performance)"
    - "Staggered child animations work for grid items"
  artifacts:
    - path: "composables/useScrollReveal.ts"
      provides: "Enhanced scroll reveal with once, rootMargin, stagger options"
      contains: "once, rootMargin, staggerChildren options"
    - path: "components/AppSection.vue"
      provides: "Support for staggered children animations"
      contains: "stagger-children class binding"
    - path: "assets/css/main.css"
      provides: "Reduced motion CSS for scroll animations"
      contains: "@media (prefers-reduced-motion: reduce)"
  key_links:
    - from: "components/AppSection.vue"
      to: "composables/useScrollReveal.ts"
      via: "useScrollReveal composable import"
      pattern: "useScrollReveal.*once.*staggerChildren"
    - from: "components/AppSection.vue"
      to: "assets/css/main.css"
      via: "reduced-motion CSS classes"
      pattern: "prefers-reduced-motion.*scroll-reveal"
---

<objective>
Enhance scroll-triggered animations with once-only observation, rootMargin trigger offset, staggered child animations, and reduced-motion support.

Purpose: Smooth scroll-triggered section reveals that respect user preferences and perform efficiently
Output: Enhanced useScrollReveal composable with options, AppSection with stagger support, reduced-motion CSS
</objective>

<execution_context>
@/Users/austinlaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/austinlaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/20-advanced-micro-interactions/20-RESEARCH.md
@.planning/phases/18-core-micro-interactions/18-01-SUMMARY.md
@.planning/phases/19-page-transitions/19-01-SUMMARY.md

@composables/useScrollReveal.ts
@components/AppSection.vue
@composables/usePageTransition.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance useScrollReveal composable with once, rootMargin, and stagger options</name>
  <files>composables/useScrollReveal.ts</files>
  <action>
    Update composables/useScrollReveal.ts to add options parameter:

    1. Add options interface:
       - threshold?: number (default 0.15)
       - once?: boolean (default true - stop observing after first reveal)
       - rootMargin?: string (default '0px' - trigger offset before element enters viewport)
       - staggerChildren?: boolean (default false)

    2. Add hasRevealed ref to track if element has already been revealed

    3. Update useIntersectionObserver call:
       - Pass rootMargin from options
       - Add stop() call when once=true and element is revealed
       - Apply stagger delays to children with class .stagger-item

    4. Return { target, isVisible, hasRevealed } from composable

    Per RESEARCH.md lines 564-607 (enhanced useScrollReveal pattern)

    DO NOT use scroll event listeners (blocks main thread). Use Intersection Observer only.
  </action>
  <verify>
    1. Check composables/useScrollReveal.ts has options parameter with once, rootMargin, staggerChildren
    2. Run npm run dev and check console for no errors
    3. Check a page with animate-on-scroll sections scroll into viewport
  </verify>
  <done>
    useScrollReveal accepts options object, stops observing after first reveal when once=true, applies stagger delays to children
  </done>
</task>

<task type="auto">
  <name>Task 2: Update AppSection to support staggered children and reduced motion</name>
  <files>components/AppSection.vue</files>
  <action>
    Update components/AppSection.vue to support staggered child animations:

    1. Add props to Props interface:
       - staggerChildren?: boolean (default false)

    2. Update useScrollReveal call in script:
       - Pass options object: { threshold: 0.15, once: true, rootMargin: '-50px', staggerChildren: props.staggerChildren }
       - Use hasRevealed return value

    3. Add stagger-children class binding to section element:
       - Add to :class array: { 'stagger-children': staggerChildren }

    4. Update CSS to add reduced motion support:
       - Add @media (prefers-reduced-motion: reduce) block
       - In reduced motion: remove transforms, keep opacity transition at 300ms linear

    Per RESEARCH.md lines 161-167 (enhancements needed for scroll animations)

    DO NOT add inline styles for stagger delays (let composable handle it).
  </action>
  <verify>
    1. Check components/AppSection.vue has staggerChildren prop
    2. Check CSS has @media (prefers-reduced-motion: reduce) block
    3. Test with OS reduced motion enabled (macOS: System Settings > Accessibility > Display > Reduce motion)
  </verify>
  <done>
    AppSection supports stagger-children prop, applies stagger delays via composable, respects reduced-motion setting
  </done>
</task>

<task type="auto">
  <name>Task 3: Add global CSS for stagger animations and reduced motion</name>
  <files>assets/css/main.css</files>
  <action>
    Update assets/css/main.css to add:

    1. Stagger animation utilities:
       - .stagger-children .stagger-item base class with opacity: 0, transform: translateY(20px)
       - Transition: opacity 600ms ease-out, transform 600ms ease-out
       - .stagger-children.visible .stagger-item with opacity: 1, transform: translateY(0)

    2. Reduced motion overrides:
       - @media (prefers-reduced-motion: reduce) block
       - Disable transforms (transform: none !important)
       - Keep opacity transition at 300ms linear for visual feedback

    3. Scroll reveal reduced motion support:
       - Update .scroll-reveal class in reduced motion block
       - Remove transforms, reduce transition to 300ms linear

    Per RESEARCH.md lines 712-718 (reduced motion CSS pattern) and Phase 19 reduced motion decisions

    DO NOT use duration-500 or longer (300ms is the standard per Phase 18 decision).
  </action>
  <verify>
    1. Check assets/css/main.css has .stagger-children and .stagger-item classes
    2. Check @media (prefers-reduced-motion: reduce) block exists
    3. Run npm run dev, inspect element to verify CSS classes applied
  </verify>
  <done>
    CSS includes stagger animation utilities with reduced-motion support, respects 300ms timing standard
  </done>
</task>

</tasks>

<verification>
1. Scroll-triggered sections animate when scrolling into viewport (fade + translateY)
2. Sections animate only once (hasRevealed flag prevents re-animation on scroll up)
3. Reduced motion users see instant opacity transition (no transforms)
4. Staggered children animate sequentially (50ms delay per child index)
5. No scroll event listeners used (Intersection Observer only)
</verification>

<success_criteria>
- useScrollReveal accepts options parameter with once, rootMargin, staggerChildren
- AppSection with stagger-children prop applies sequential delays to child items
- Reduced-motion users see instant opacity changes (no transforms)
- All animations use 300ms timing standard (Phase 18 decision)
- Sections observe once only (performance optimization via stop() call)
</success_criteria>

<output>
After completion, create `.planning/phases/20-advanced-micro-interactions/20-01-SUMMARY.md`
</output>
