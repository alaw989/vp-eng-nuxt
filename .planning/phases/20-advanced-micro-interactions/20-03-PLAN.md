---
phase: 20-advanced-micro-interactions
plan: 03
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - composables/useFilterTransition.ts
  - pages/services/index.vue
  - pages/projects/index.vue
autonomous: false

must_haves:
  truths:
    - "Service filter changes layout smoothly (FLIP animation)"
    - "Project filter changes layout smoothly (FLIP animation)"
    - "Cards animate from old positions to new positions (300ms ease-out)"
    - "Reduced-motion users see instant layout change (no FLIP animation)"
  artifacts:
    - path: "composables/useFilterTransition.ts"
      provides: "FLIP animation composable for filter layout changes"
      exports: ["useFilterTransition", "animateFilter", "containerRef"]
    - path: "pages/services/index.vue"
      provides: "Service filter with FLIP animation"
      contains: "useFilterTransition import, animateFilter call"
    - path: "pages/projects/index.vue"
      provides: "Project filter with FLIP animation"
      contains: "useFilterTransition import, animateFilter call"
  key_links:
    - from: "pages/services/index.vue"
      to: "composables/useFilterTransition.ts"
      via: "useFilterTransition composable import"
      pattern: "useFilterTransition.*animateFilter"
    - from: "pages/projects/index.vue"
      to: "composables/useFilterTransition.ts"
      via: "useFilterTransition composable import"
      pattern: "useFilterTransition.*animateFilter"
---

<objective>
Implement FLIP (First, Last, Invert, Play) technique for smooth layout transitions when filtering services and projects.

Purpose: Smooth filter animations without layout thrashing, using transform-only animations for 60fps performance
Output: Hand-rolled useFilterTransition composable, integrated into services and projects filter pages
</objective>

<execution_context>
@/Users/austinlaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/austinlaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/20-advanced-micro-interactions/20-RESEARCH.md
@.planning/phases/18-core-micro-interactions/18-01-SUMMARY.md
@.planning/phases/20-advanced-micro-interactions/20-01-SUMMARY.md

@pages/services/index.vue
@pages/projects/index.vue
@composables/usePageTransition.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFilterTransition composable with FLIP technique</name>
  <files>composables/useFilterTransition.ts</files>
  <action>
    Create composables/useFilterTransition.ts implementing FLIP technique:

    1. Define generic function: export function useFilterTransition<T>()

    2. Return values:
       - containerRef: Ref<HTMLElement | undefined>
       - animateFilter: (items: T[]) => Promise<void>
       - isAnimating: Ref<boolean>

    3. Implement FLIP in animateFilter function:
       - FIRST: Capture old positions (getBoundingClientRect) of all children in Map
       - Wait for DOM update: await nextTick()
       - LAST: Capture new positions after filter change
       - INVERT: Calculate delta X/Y for each element, apply transform
       - PLAY: Animate to natural positions with 300ms ease-out
       - Cleanup: Remove inline styles after animation completes

    4. Add reduced-motion check:
       - Import usePreferredReducedMotion from @vueuse/core
       - If reduced motion: skip FLIP, return immediately
       - Only run FLIP animation for non-reduced-motion users

    5. Handle edge cases:
       - Skip elements with no movement (deltaX === 0 && deltaY === 0)
       - Force reflow with void element.offsetWidth after applying inverted transform
       - Use Promise.all() to wait for all transitionend events

    Per RESEARCH.md lines 726-823 (FLIP implementation pattern)

    DO NOT animate width/height/top/left (layout properties cause reflow).
    DO use transform only (GPU-accelerated, no layout recalculation).
    DO NOT use @formkit/auto-animate (hand-rolled per research decision).
  </action>
  <verify>
    1. Check composables/useFilterTransition.ts exists
    2. Check function exports useFilterTransition with containerRef, animateFilter, isAnimating
    3. Check FLIP steps: FIRST (old positions), LAST (new positions), INVERT (transform), PLAY (animation)
    4. Check usePreferredReducedMotion import and check
  </verify>
  <done>
    useFilterTransition composable created with hand-rolled FLIP technique, reduced-motion support, proper cleanup
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>FLIP animation composable for smooth filter transitions</what-built>
  <how-to-verify>
    1. Run npm run dev
    2. Navigate to /services
    3. Click different category filter buttons
    4. Verify cards animate smoothly from old positions to new positions
    5. Enable OS reduced motion (macOS: System Settings > Accessibility > Display > Reduce motion)
    6. Verify filter change is instant (no animation)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with the FLIP animation</resume-signal>
</checkpoint>
</task>

<task type="auto">
  <name>Task 2: Integrate useFilterTransition into services page</name>
  <files>pages/services/index.vue</files>
  <action>
    Update pages/services/index.vue to use FLIP animation:

    1. Import useFilterTransition:
       Add: import { useFilterTransition } from '~/composables/useFilterTransition'

    2. Initialize composable in script setup:
       const { containerRef: servicesContainer, animateFilter } = useFilterTransition()

    3. Add ref to services grid container:
       Change: <div v-else-if="filteredServices.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-8">
       To: <div ref="servicesContainer" v-else-if="filteredServices.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-8">

    4. Add watch on filteredServices to trigger animation:
       Add after filteredServices computed:
       watch(filteredServices, async (newServices) => {
         await animateFilter(newServices)
       })

    Per RESEARCH.md lines 804-822 (usage pattern)

    DO NOT add TransitionGroup wrapper (FLIP handles layout changes without it).
    DO NOT change the filter logic (only add animation on top).
  </action>
  <verify>
    1. Check pages/services/index.vue imports useFilterTransition
    2. Check servicesContainer ref is bound to grid container
    3. Check watch(filteredServices) calls animateFilter
    4. Test filter buttons and verify smooth animation
  </verify>
  <done>
    Services filter uses FLIP animation, cards glide smoothly to new positions
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate useFilterTransition into projects page</name>
  <files>pages/projects/index.vue</files>
  <action>
    Update pages/projects/index.vue to use FLIP animation:

    1. Import useFilterTransition:
       Add: import { useFilterTransition } from '~/composables/useFilterTransition'

    2. Initialize composable in script setup:
       const { containerRef: projectsContainer, animateFilter } = useFilterTransition()

    3. Add ref to projects grid container:
       Find the grid container with ProjectCard components
       Add: ref="projectsContainer" to the container div

    4. Add watch on filteredProjects to trigger animation:
       Add after filteredProjects computed:
       watch(filteredProjects, async (newProjects) => {
         await animateFilter(newProjects)
       })

    Note: Projects page has pagination - ensure FLIP only animates visible items on current page

    DO NOT modify pagination logic (FLIP should work within paginated subset).
    DO NOT change filter buttons or category logic.
  </action>
  <verify>
    1. Check pages/projects/index.vue imports useFilterTransition
    2. Check projectsContainer ref is bound to grid container
    3. Check watch(filteredProjects) calls animateFilter
    4. Test filter buttons and verify smooth animation
  </verify>
  <done>
    Projects filter uses FLIP animation, cards glide smoothly to new positions
  </done>
</task>

</tasks>

<verification>
1. Clicking service category buttons triggers smooth card repositioning (300ms ease-out)
2. Clicking project category/type filters triggers smooth card repositioning
3. Cards animate from old positions to new positions (no jarring jumps)
4. Reduced-motion users see instant layout change (no FLIP animation)
5. No layout thrashing (transform-only animation, GPU-accelerated)
</verification>

<success_criteria>
- useFilterTransition composable implements FLIP technique (First, Last, Invert, Play)
- Services page filters trigger smooth 300ms ease-out transitions
- Projects page filters trigger smooth 300ms ease-out transitions
- Reduced-motion users skip FLIP animation (instant layout change)
- No width/height/top/left animations (transform-only for performance)
</success_criteria>

<output>
After completion, create `.planning/phases/20-advanced-micro-interactions/20-03-SUMMARY.md`
</output>
