---
phase: 07-section-polish---projects
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - pages/projects/[slug].vue
  - components/ProjectGallery.vue
  - public/images/image-mapping.json
autonomous: true

must_haves:
  truths:
    - "Project images from Phase 3 migration display correctly on detail pages"
    - "Featured hero image shows large at top with click-to-open lightbox"
    - "Thumbnail strip below hero shows all available project images"
    - "Clicking thumbnails swaps the featured image"
    - "Lightbox opens with full-screen image and navigation arrows"
    - "All project images use WebP format with responsive srcset"
  artifacts:
    - path: "components/ProjectGallery.vue"
      provides: "Project image gallery with lightbox and thumbnail navigation"
      min_lines: 280
    - path: "pages/projects/[slug].vue"
      provides: "Project detail page with ProjectGallery integration"
      contains: "LazyProjectGallery"
  key_links:
    - from: "pages/projects/[slug].vue"
      to: "components/ProjectGallery.vue"
      via: ":images prop binding"
      pattern: ":images=.*projectImages"
    - from: "components/ProjectGallery.vue"
      to: "/images/projects/*.webp"
      via: "NuxtImg src attribute"
      pattern: "images/projects.*\.webp"
    - from: "components/ProjectGallery.vue"
      to: "public/images/image-mapping.json"
      via: "Image path resolution from Phase 3 mapping"
      pattern: "image-mapping"
---

<objective>
Migrate and optimize project images from Phase 3 mapping, integrate with ProjectGallery component, and ensure all project images display correctly with responsive loading.

Purpose: Project images were migrated in Phase 3 to /images/projects/ directory. These images need to be integrated into the project detail pages via the ProjectGallery component. The gallery should display the featured hero image with thumbnail navigation and full-screen lightbox functionality.

Output: Project detail pages display all available project images from Phase 3 migration via ProjectGallery component with responsive WebP loading.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-section-polish---projects/07-CONTEXT.md
@.planning/phases/03-image-migration/03-03-SUMMARY.md
@pages/projects/[slug].vue
@components/ProjectGallery.vue
@public/images/image-mapping.json
</context>

<tasks>

<task type="auto">
  <name>Integrate Phase 3 project images with ProjectGallery</name>
  <files>pages/projects/[slug].vue</files>
  <action>
    Update pages/projects/[slug].vue to use real project images from Phase 3:

    1. Read image-mapping.json to understand project image structure:
       - Projects category images are in /images/projects/
       - Each image has webp variants (small: 640w, medium: 1280w, large: 1920w)
       - Filenames follow pattern: {basename}-{width}w.webp

    2. Update projectImages computed (lines 330-334) to use real images:
       - Check if apiProject.value.images exists from WordPress API
       - If not, build from image-mapping.json lookup by project slug
       - Use large variant (1920w) for featured, small/medium for thumbnails
       - Return array of image paths for ProjectGallery

    3. Map project slugs to their images from Phase 3:
       - tampa-marina-complex: steel-connect, shallowdeepfoundationdesign10, or other project images
       - downtown-office-tower: skyskr-1, lowrise
       - coastal-seawall-system: marine/structure images
       - Use image-mapping.json to find all category: "projects" images

    4. Add fallback for missing images:
       - If no images found, return empty array (gallery shows placeholder)
       - Log warning for missing project image mapping

    5. Verify LazyProjectGallery props (lines 66-69):
       - :images="projectImages" (array of image paths)
       - :project-name="project.title.rendered || 'Project'"
  </action>
  <verify>npm run dev, navigate to /projects/tampa-marina-complex, verify gallery displays with real project images from /images/projects/, check Network tab for WebP loading</verify>
  <done>ProjectGallery displays real project images from Phase 3 migration, images load as WebP format with responsive variants, placeholder shows when no images available</done>
</task>

<task type="auto">
  <name>Verify ProjectGallery component functionality</name>
  <files>components/ProjectGallery.vue</files>
  <action>
    Verify ProjectGallery component works correctly with real images:

    1. Verify featured image display (lines 4-41):
       - aspect-[16/9] container with rounded-2xl
       - NuxtImg with images[0] as featured
       - Click handler opens lightbox (openLightbox(0))
       - Hover effect shows magnify icon overlay
       - Placeholder gradient when images.length === 0

    2. Verify thumbnail grid (lines 44-80):
       - Grid: grid-cols-4 md:grid-cols-5 with gap-4
       - Shows all images (or first 5 with "show more" button)
       - Click thumbnail opens lightbox at that index
       - Active thumbnail has ring-2 ring-primary

    3. Verify lightbox functionality (lines 83-189):
       - Teleport to body for z-index stacking
       - Full-screen overlay with bg-black/90
       - Main image with Transition for smooth swaps
       - Navigation arrows (prev/next) with keyboard support
       - Thumbnail strip at bottom for direct navigation
       - Image counter (X / Y)
       - Close button (X) and ESC key support

    4. Verify accessibility:
       - role="dialog" and aria-modal="true"
       - aria-label for gallery and images
       - Focus trap implementation
       - Keyboard navigation (arrows, Home, End, ESC)
       - Returns focus on close

    5. Verify image attributes:
       - format="webp" for modern format
       - sizes attribute for responsive loading
       - width/height for aspect ratio
       - placeholder for LQIP blur-up
  </action>
  <verify>Click featured image to open lightbox, use arrow keys to navigate, click thumbnails to swap images, press ESC to close, verify focus returns to triggering element</verify>
  <done>Lightbox opens on click, navigation arrows work, thumbnail clicking swaps image, keyboard navigation works (arrows/Home/End/ESC), focus trap works, focus returns on close, images display with proper aspect ratio</done>
</task>

<task type="auto">
  <name>Optimize project image loading and verify responsive srcset</name>
  <files>components/ProjectGallery.vue, pages/projects/[slug].vue</files>
  <action>
    Optimize image loading for performance:

    1. Verify featured image loading (lines 12-24):
       - loading="eager" for first image (LCP candidate)
       - fetchpriority="high"
       - sizes="100vw" for full viewport width
       - width="1920" height="1080"

    2. Verify thumbnail loading (lines 58-68):
       - loading="lazy" for off-screen images
       - sizes="(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 20vw"
       - width="400" height="225"

    3. Verify lightbox image loading (lines 141-151):
       - loading="eager" (user clicked, wants full image)
       - sizes="100vw" for max width
       - placeholder for smooth transitions

    4. Check for unused imports or duplicate logic:
       - Remove any console.log statements
       - Clean up commented-out code

    5. Verify image fallback chain:
       - Try WebP first (format="webp")
       - Browser falls back to source type if unsupported
       - NuxtImg handles fallback automatically

    6. Add error handling for missing images:
       - v-if condition checks images.length > 0
       - Fallback placeholder displays when empty
  </action>
  <verify>Run Lighthouse audit on project detail page, verify Cumulative Layout Shift (CLS) is low, check Network tab for image sizes, verify eager/lazy loading is applied correctly</verify>
  <done>Lighthouse performance score 85+ for project detail page, CLS < 0.1, images load in appropriate sizes, eager loading on featured image, lazy loading on thumbnails, proper fallbacks in place</done>
</task>

</tasks>

<verification>
1. Build completes without errors: npm run build
2. Project images from Phase 3 display correctly
3. Featured image shows at top of detail page
4. Thumbnail strip shows all available images
5. Clicking thumbnails swaps featured image
6. Lightbox opens with full-screen image
7. Navigation arrows work in lightbox
8. Keyboard navigation works (arrows, ESC)
9. Images load as WebP with responsive variants
10. Lighthouse performance score acceptable
</verification>

<success_criteria>
- All project images from Phase 3 migration display correctly
- Featured hero image shows large at top of detail page
- Thumbnail strip displays below hero image
- Clicking thumbnails swaps the featured image
- Lightbox opens with full-screen image view
- Lightbox navigation works (arrows, keyboard)
- Images use WebP format with responsive loading
- Lighthouse performance score acceptable
</success_criteria>

<output>
After completion, create `.planning/phases/07-section-polish---projects/07-03-SUMMARY.md`
</output>
