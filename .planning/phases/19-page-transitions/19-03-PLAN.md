---
phase: 19-page-transitions
plan: 03
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - layouts/default.vue
  - layouts/landing.vue
autonomous: true

must_haves:
  truths:
    - "Layout transitions work smoothly when switching between default and landing layouts"
    - "NuxtLayout wrapper is present in layouts to enable layout transitions"
    - "Layout transitions use same 150ms cross-fade as page transitions"
    - "Focus management continues to work during layout transitions"
  artifacts:
    - path: "layouts/default.vue"
      contains: "<NuxtLayout>"
      contains: "useRouteFocus"
    - path: "layouts/landing.vue"
      contains: "<NuxtLayout>"
      min_lines: 10
  key_links:
    - from: "layouts/default.vue"
      to: "composables/useFocusManager.ts"
      via: "useRouteFocus import and usage"
      pattern: "useRouteFocus"
---

<objective>
Ensure layout transitions work smoothly when navigating between pages with different layouts, maintaining 150ms cross-fade effect and focus management.

Purpose: Nuxt uses layout transitions instead of page transitions when layouts differ. Project has both default.vue and landing.vue layouts, so we must ensure NuxtLayout wrapper is present and focus management is preserved.

Output: Verified layout transition setup with working focus management.
</objective>

<execution_context>
@/Users/austinlaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/austinlaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-page-transitions/19-CONTEXT.md
@.planning/phases/19-page-transitions/19-RESEARCH.md

# Prior work
@composables/useFocusManager.ts (Phase 17: focus management utilities)
@composables/useA11y.ts (Phase 17: useA11yRouteAnnouncer for route announcements)

# Current state
@layouts/default.vue (needs verification of NuxtLayout wrapper)
@layouts/landing.vue (needs verification of NuxtLayout wrapper)
</context>

<tasks>

<task type="auto">
  <name>Verify default.vue has NuxtLayout wrapper</name>
  <files>layouts/default.vue</files>
  <action>
    Read layouts/default.vue and verify:

    1. If it has <NuxtPage> directly, wrap it with <NuxtLayout>:
       ```vue
       <template>
         <NuxtLayout>
           <NuxtPage />
         </NuxtLayout>
       </template>
       ```

    2. If it already has <NuxtLayout>, verify it's properly wrapping <NuxtPage>

    3. Ensure focus management code (useRouteFocus from composables/useFocusManager.ts)
       is still present and working - this was added in Phase 17

    The <NuxtLayout> wrapper enables Nuxt's layout transition system. Without it,
    layout transitions won't run when switching between layouts.

    DO NOT remove or modify focus management code - it must continue to work.
  </action>
  <verify>grep -q "<NuxtLayout>" layouts/default.vue && grep -q "useRouteFocus" layouts/default.vue</verify>
  <done>default.vue has NuxtLayout wrapper and focus management</done>
</task>

<task type="auto">
  <name>Verify landing.vue has NuxtLayout wrapper</name>
  <files>layouts/landing.vue</files>
  <action>
    Read layouts/landing.vue and verify:

    1. If it has <NuxtPage> directly, wrap it with <NuxtLayout>:
       ```vue
       <template>
         <NuxtLayout>
           <NuxtPage />
         </NuxtLayout>
       </template>
       ```

    2. If it already has <NuxtLayout>, verify it's properly wrapping <NuxtPage>

    3. If it has any focus management code, ensure it's preserved

    The landing layout should have the same NuxtLayout wrapper structure as default.vue
    to ensure consistent layout transitions.

    Note: landing.vue may be simpler than default.vue (fewer components), but the
    NuxtLayout wrapper must be present.
  </action>
  <verify>grep -q "<NuxtLayout>" layouts/landing.vue || test ! -f layouts/landing.vue</verify>
  <done>landing.vue has NuxtLayout wrapper (or file doesn't exist)</done>
</task>

<task type="auto">
  <name>Test layout transitions work correctly</name>
  <files>layouts/default.vue</files>
  <action>
    Add a CSS comment to layouts/default.vue documenting layout transition behavior:

    In a <style> block or CSS comment, add:
    ```css
    /* Layout transitions use 150ms cross-fade (see assets/css/main.css)
     * Layout transitions run when navigating between pages with different layouts.
     * This site uses default.vue and landing.vue layouts.
     * Both layouts must wrap <NuxtPage> with <NuxtLayout> for transitions to work.
     */
    ```

    This comment documents why NuxtLayout wrapper is required and helps future
    developers understand the layout transition system.

    Then, verify by checking that:
    - nuxt.config.ts has layoutTransition config (already present from 19-01)
    - assets/css/main.css has .layout-enter-active/leave-active classes (already present from 19-01)
  </action>
  <verify>grep -q "Layout transitions" layouts/default.vue</verify>
  <done>CSS comment documents layout transition requirement</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Check which pages use which layout:
   - Most pages use default.vue layout
   - Some pages may use landing.vue layout (if any)

2. Navigate between pages with different layouts (if both layouts are used):
   - Observe smooth 150ms cross-fade transition
   - No jarring layout shifts

3. Test focus management during layout transitions:
   - Enable a screen reader or use Tab navigation
   - Navigate between pages
   - Verify focus moves to main-content after route change (from Phase 17)

4. If only one layout is used (default.vue for all pages):
   - Layout transitions won't run (no layout changes)
   - Page transitions still run (from 19-01)
   - This is expected behavior - layout transitions only apply when layouts differ
</verification>

<success_criteria>
1. Both layouts have <NuxtLayout> wrapper wrapping <NuxtPage>
2. Focus management (useRouteFocus) continues to work in default.vue
3. Layout transition CSS exists in main.css (from 19-01)
4. nuxt.config.ts has layoutTransition config (from 19-01)
5. CSS comment in default.vue documents layout transition behavior
</success_criteria>

<output>
After completion, create .planning/phases/19-page-transitions/19-03-SUMMARY.md
</output>
