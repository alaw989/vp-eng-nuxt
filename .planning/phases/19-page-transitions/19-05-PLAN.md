---
phase: 19-page-transitions
plan: 05
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - middleware/transition-direction.global.ts
  - pages/projects/[slug].vue
  - pages/services/[slug].vue
autonomous: true

must_haves:
  truths:
    - "Explicit route pairs use directional transitions (list -> detail, detail -> list)"
    - "Projects index to project detail uses slide-left transition"
    - "Project detail to projects index uses slide-right transition"
    - "Services index to service detail uses slide-left transition"
    - "Service detail to services index uses slide-right transition"
    - "Routes not in explicit pairs fall back to standard cross-fade"
  artifacts:
    - path: "middleware/transition-direction.global.ts"
      contains: "defineNuxtRouteMiddleware"
      contains: "directionalPairs"
      min_lines: 40
    - path: "assets/css/main.css"
      contains: ".slide-left-enter-active"
      contains: ".slide-right-enter-active"
  key_links:
    - from: "middleware/transition-direction.global.ts"
      to: "pages/projects/[slug].vue"
      via: "to.meta.pageTransition.name modification"
      pattern: "to.meta.pageTransition.name = 'slide-left'"
---

<objective>
Implement directional transitions for explicit route pairs (projects and services detail navigation) using global middleware, with fallback to standard cross-fade for other routes.

Purpose: User specified cross-fade for most transitions, but directional transitions (slide effects) for explicit route pairs add helpful context. Which pairs get directionality is at Claude's discretion - projects/[slug] and services/[slug] are the most valuable.

Output: Created middleware with directional route pairs and CSS for slide transitions.
</objective>

<execution_context>
@/Users/austinlaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/austinlaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-page-transitions/19-CONTEXT.md
@.planning/phases/19-page-transitions/19-RESEARCH.md

# Current state
@nuxt.config.ts (has pageTransition and layoutTransition configured)
@pages/projects/index.vue (projects list page)
@pages/projects/[slug].vue (project detail page)
@pages/services/index.vue (services list page)
@pages/services/[slug].vue (service detail page)

# Claude's discretion (from CONTEXT.md)
- Which specific route pairs get directional transitions
- Fallback behavior for routes not in explicit pairs
</context>

<tasks>

<task type="auto">
  <name>Create directional transition middleware</name>
  <files>middleware/transition-direction.global.ts</files>
  <action>
    Create middleware/transition-direction.global.ts with:

    ```typescript
    export default defineNuxtRouteMiddleware((to, from) => {
      // Explicit route pairs that get directional transitions
      const directionalPairs = [
        // Projects: list -> detail (forward)
        { from: '/projects', to: /^\/projects\/[^/]+$/, direction: 'forward' },
        // Projects: detail -> list (back)
        { from: /^\/projects\/[^/]+$/, to: '/projects', direction: 'back' },
        // Services: list -> detail (forward)
        { from: '/services', to: /^\/services\/[^/]+$/, direction: 'forward' },
        // Services: detail -> list (back)
        { from: /^\/services\/[^/]+$/, to: '/services', direction: 'back' },
      ]

      // Check if current navigation matches a directional pair
      for (const pair of directionalPairs) {
        const fromMatch = typeof pair.from === 'string'
          ? from.path === pair.from
          : pair.from.test(from.path)
        const toMatch = typeof pair.to === 'string'
          ? to.path === pair.to
          : pair.to.test(to.path)

        if (fromMatch && toMatch) {
          // Set dynamic transition name
          if (to.meta.pageTransition && typeof to.meta.pageTransition !== 'boolean') {
            to.meta.pageTransition.name = pair.direction === 'forward' ? 'slide-left' : 'slide-right'
          }
          return
        }
      }

      // Default to cross-fade for non-matching routes
      if (to.meta.pageTransition && typeof to.meta.pageTransition !== 'boolean') {
        to.meta.pageTransition.name = 'page'
      }
    })
    ```

    Pattern from research: Use global middleware to modify to.meta.pageTransition.name
    based on route navigation. Routes not in explicit pairs default to 'page' (cross-fade).

    Claude's discretion: Chose projects and services for directional transitions because
    they have clear list/detail hierarchy where directionality provides helpful context.
  </action>
  <verify>test -f middleware/transition-direction.global.ts && grep -q "directionalPairs" middleware/transition-direction.global.ts</verify>
  <done>Directional transition middleware created with projects/services route pairs</done>
</task>

<task type="auto">
  <name>Add CSS for slide transitions</name>
  <files>assets/css/main.css</files>
  <action>
    In assets/css/main.css, add CSS for slide-left and slide-right transitions:

    Add after the page/layout transition styles (after line 152):

    ```css
    /* Directional slide transitions for list/detail navigation (150ms) */
    .slide-left-enter-active,
    .slide-left-leave-active,
    .slide-right-enter-active,
    .slide-right-leave-active {
      transition: opacity 150ms ease-in-out, transform 150ms ease-in-out;
    }

    /* Slide left (forward: list -> detail) */
    .slide-left-enter-from {
      opacity: 0;
      transform: translateX(20px);
    }

    .slide-left-leave-to {
      opacity: 0;
      transform: translateX(-20px);
    }

    /* Slide right (back: detail -> list) */
    .slide-right-enter-from {
      opacity: 0;
      transform: translateX(-20px);
    }

    .slide-right-leave-to {
      opacity: 0;
      transform: translateX(20px);
    }
    ```

    Per CONTEXT.md: User said "Which route pairs get directionality is at Claude's discretion"
    and per research: "Forward navigation slides left, back navigation slides right."

    Reduced motion support: The @media (prefers-reduced-motion: reduce) block (from 19-02)
    will override these transforms with transform: none, so reduced motion users get
    cross-fade even for directional routes.
  </action>
  <verify>grep -q "\.slide-left-enter-active" assets/css/main.css && grep -q "\.slide-right-enter-active" assets/css/main.css</verify>
  <done>CSS for slide-left and slide-right transitions added</done>
</task>

<task type="auto">
  <name>Add reduced motion support for slide transitions</name>
  <files>assets/css/main.css</files>
  <action>
    In the @media (prefers-reduced-motion: reduce) block, add rules to disable
    slide transition transforms:

    Add to the existing reduced motion block (lines 157-185):
    ```css
    /* Disable slide transforms in reduced motion mode */
    .slide-left-enter-from,
    .slide-left-leave-to,
    .slide-right-enter-from,
    .slide-right-leave-to {
      transform: none !important;
    }
    ```

    This ensures that even though slide transitions use transforms, reduced motion
    users get a simple cross-fade (opacity only) instead.

    Combined with the reduced motion transition duration override (150ms linear from 19-02),
    reduced motion users get consistent cross-fade behavior for all routes.
  </action>
  <verify>grep -A 15 "prefers-reduced-motion: reduce" assets/css/main.css | grep -q "slide-left"</verify>
  <done>Reduced motion CSS disables slide transition transforms</done>
</task>

<task type="auto">
  <name>Test directional transitions work correctly</name>
  <files>middleware/transition-direction.global.ts</files>
  <action>
    Add a comment to middleware/transition-direction.global.ts documenting how to test:

    ```typescript
    /*
     * Directional transitions for list/detail navigation:
     *
     * Test by navigating:
     * 1. Projects list -> Project detail: Should slide LEFT (forward)
     * 2. Project detail -> Projects list: Should slide RIGHT (back)
     * 3. Services list -> Service detail: Should slide LEFT (forward)
     * 4. Service detail -> Services list: Should slide RIGHT (back)
     * 5. Other routes (Home -> About): Should cross-fade (no slide)
     *
     * Reduced motion users always get cross-fade (no slide) regardless of route.
     */
    ```

    This comment documents the expected behavior and helps with testing.

    Then verify by:
    1. Checking that middleware file has .global suffix (runs on all routes)
    2. Checking that directionalPairs array has the expected routes
    3. Checking that default transition name is 'page' (cross-fade)
  </action>
  <verify>grep -q "Test by navigating" middleware/transition-direction.global.ts</verify>
  <done>CSS comment documents how to test directional transitions</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Navigate to Projects list page (/projects)
2. Click on a project to go to detail page (/projects/slug)
   - Observe: Page slides in from RIGHT (content moves left)
   - This is "slide-left" transition (forward navigation)

3. Click "Back to Projects" or navigate to /projects
   - Observe: Page slides in from LEFT (content moves right)
   - This is "slide-right" transition (back navigation)

4. Navigate between other routes (Home -> About -> Contact)
   - Observe: Standard cross-fade (no slide)
   - These routes are not in explicit pairs

5. Enable reduced motion and test again:
   - All routes (including projects/services) use cross-fade
   - No slide effects occur
   - Transitions use 150ms linear easing

6. Check DevTools Performance tab:
   - Directional transitions are 150ms
   - Cross-fade transitions are 150ms
</verification>

<success_criteria>
1. Middleware assigns slide-left transition for list -> detail navigation
2. Middleware assigns slide-right transition for detail -> list navigation
3. Routes not in explicit pairs use standard cross-fade (page transition)
4. CSS for slide-left and slide-right is present in main.css
5. Reduced motion users get cross-fade for all routes (no slide effects)
6. Middleware comment documents how to test directional transitions
</success_criteria>

<output>
After completion, create .planning/phases/19-page-transitions/19-05-SUMMARY.md
</output>
